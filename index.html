<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RT Character Sorter</title>
<link href="https://fonts.googleapis.com/css?family=Josefin+Slab:600" rel="stylesheet">
<style>
body {
  font-family: 'Times New Roman', serif;
  text-align: center;
  margin: 0 auto;
  padding: 20px;
  max-width: 600px;
}
#mainTable{
  font-size: 18px;
  text-align: center;
  width: 100%;
  max-width: 400px;
  margin: 0 auto;
  border-collapse: separate;
  border-spacing: 10px 5px;
}
#leftField, #rightField {
  width: 120px;
  height: 150px;
  border: 1px solid #000;
  cursor: pointer;
  font-size: 16px;
  display: flex;
  justify-content: center;
  align-items: center;
}
.middleField {
  width: 120px;
  height: 70px;
  border: 1px solid #000;
  cursor: pointer;
  font-size: 14px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: auto;
}
a { color: #e097d9; text-decoration: none; }
a:hover { color: #8f8f8f; }
</style>
</head>
<body>

<h2>RT Character Sorter</h2>
<p>Pick who you like better in each battle to get an accurate ranking. "I like both" or "No opinion" will affect your results if used too often.</p>

<table id="mainTable">
<tr>
<td id="battleNumber" colspan="3" style="padding-bottom:10px;"><b>battle #1<br>0% sorted.</b></td>
</tr>
<tr>
<td id="leftField" rowspan="2"></td>
<td class="middleField">I like both</td>
<td id="rightField" rowspan="2"></td>
</tr>
<tr>
<td class="middleField">No opinion</td>
</tr>
</table>

<div id="resultField" style="margin-top:20px;"></div>

<script>
//===================== SORTER JS =======================
var namMember=["Awake","Epiphany","Abyss","Tonight","Yours","Close To You","Super Tuna","Running Wild","I'll Be There","Another Level","Falling","Falling ft. Taka","Heart On The Window ft. WENDY","I will come to you","Don't Say You Love Me","Nothing Without Your Love","Loser ft. YENA","Rope It","Background","With The Clouds","To Me, Today","The Astronaut","Moon","It's Definitely You with V"];

var lstMember=[], parent=[], equal=[], rec=[];
var cmp1, cmp2, head1, head2;
var nrec, numQuestion, totalSize, finishSize, finishFlag;

function initList() {
    var n=0, mid, i;
    lstMember[n]=[]; for(i=0;i<namMember.length;i++) lstMember[n][i]=i;
    parent[n]=-1; totalSize=0; n++;
    for(i=0;i<lstMember.length;i++){
        if(lstMember[i].length>=2){
            mid=Math.ceil(lstMember[i].length/2);
            lstMember[n]=lstMember[i].slice(0,mid); totalSize+=lstMember[n].length; parent[n]=i; n++;
            lstMember[n]=lstMember[i].slice(mid); totalSize+=lstMember[n].length; parent[n]=i; n++;
        }
    }
    for(i=0;i<namMember.length;i++) rec[i]=0;
    nrec=0; for(i=0;i<=namMember.length;i++) equal[i]=-1;
    cmp1=lstMember.length-2; cmp2=lstMember.length-1; head1=head2=0; numQuestion=1; finishSize=0; finishFlag=0;
}

function sortList(flag){
    if(flag<0){rec[nrec]=lstMember[cmp1][head1];head1++;nrec++;finishSize++;while(equal[rec[nrec-1]]!=-1){rec[nrec]=lstMember[cmp1][head1];head1++;nrec++;finishSize++;}}
    else if(flag>0){rec[nrec]=lstMember[cmp2][head2];head2++;nrec++;finishSize++;while(equal[rec[nrec-1]]!=-1){rec[nrec]=lstMember[cmp2][head2];head2++;nrec++;finishSize++;}}
    else{
        rec[nrec]=lstMember[cmp1][head1];head1++;nrec++;finishSize++;
        while(equal[rec[nrec-1]]!=-1){rec[nrec]=lstMember[cmp1][head1];head1++;nrec++;finishSize++;}
        equal[rec[nrec-1]]=lstMember[cmp2][head2]; rec[nrec]=lstMember[cmp2][head2]; head2++; nrec++; finishSize++;
        while(equal[rec[nrec-1]]!=-1){rec[nrec]=lstMember[cmp2][head2];head2++;nrec++;finishSize++;}
    }

    if(head1<lstMember[cmp1].length && head2==lstMember[cmp2].length){while(head1<lstMember[cmp1].length){rec[nrec]=lstMember[cmp1][head1];head1++;nrec++;finishSize++;}}
    else if(head1==lstMember[cmp1].length && head2<lstMember[cmp2].length){while(head2<lstMember[cmp2].length){rec[nrec]=lstMember[cmp2][head2];head2++;nrec++;finishSize++;}}

    if(head1==lstMember[cmp1].length && head2==lstMember[cmp2].length){
        for(var i=0;i<lstMember[cmp1].length+lstMember[cmp2].length;i++){lstMember[parent[cmp1]][i]=rec[i];}
        lstMember.pop(); lstMember.pop(); cmp1-=2; cmp2-=2; head1=head2=0; for(i=0;i<namMember.length;i++) rec[i]=0; nrec=0;
    }

    if(cmp1<0){showResult(); finishFlag=1;} else {showImage();}
}

function showResult(){
    var ranking=1, sameRank=1, str="<table style='width:100%;max-width:200px;font-size:16px;line-height:120%;margin:auto;border:1px solid #000;border-collapse:collapse'><tr><td style='color:#fff;background-color:#e097d9;text-align:center;'>rank</td><td style='color:#fff;background-color:#e097d9;text-align:center;'>options</td></tr>", i;
    for(i=0;i<namMember.length;i++){
        str+="<tr><td style='border:1px solid #000;text-align:center;'>"+ranking+"</td><td style='border:1px solid #000;'>"+namMember[lstMember[0][i]]+"</td></tr>";
        if(i<namMember.length-1){if(equal[lstMember[0][i]]==lstMember[0][i+1]) sameRank++; else {ranking+=sameRank; sameRank=1;}}
    }
    str+="</table>";
    document.getElementById("resultField").innerHTML=str;
}

function showImage(){
    document.getElementById("battleNumber").innerHTML="battle #"+numQuestion+"<br>"+Math.floor(finishSize*100/totalSize)+"% sorted.";
    document.getElementById("leftField").innerHTML=namMember[lstMember[cmp1][head1]];
    document.getElementById("rightField").innerHTML=namMember[lstMember[cmp2][head2]];
    numQuestion++;
}

// Attach click events
function attachClicks(){
    document.getElementById("leftField").onclick=function(){if(finishFlag==0) sortList(-1);};
    document.getElementById("rightField").onclick=function(){if(finishFlag==0) sortList(1);};
    var middleFields=document.querySelectorAll(".middleField");
    middleFields.forEach(function(el){el.onclick=function(){if(finishFlag==0) sortList(0);};});
}

// Initialize
initList();
showImage();
attachClicks();
</script>

<p style="text-align:center;"><small><a href="https://biasorter.tumblr.com/">Created by biasorter</a></small></p>
</body>
</html>
